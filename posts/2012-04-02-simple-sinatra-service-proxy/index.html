<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Simple Sinatra Service Proxy - Technical Partner for Startups | Damian Galarza, Fractional CTO</title><meta name=description content="Use Sinatra to rapidly build a proxy for a service when you can&rsquo;t make cross-origin AJAX requests in development."><link rel=stylesheet href=/css/style.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-5Y6WCB7SKQ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5Y6WCB7SKQ")</script><link rel=icon href=/favicon.ico><link rel=canonical href=https://damiangalarza.com/posts/2012-04-02-simple-sinatra-service-proxy/><meta property="og:type" content="article"><meta property="og:title" content="Simple Sinatra Service Proxy"><meta property="og:description" content><meta property="og:url" content="https://damiangalarza.com/posts/2012-04-02-simple-sinatra-service-proxy/"><meta property="og:site_name" content="Technical Partner for Startups | Damian Galarza, Fractional CTO"><meta property="og:image" content="https://damiangalarza.com/images/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:image:alt" content="Damian Galarza - Technical Partner & Fractional CTO"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@dgalarza"><meta name=twitter:creator content="@dgalarza"><meta name=twitter:image content="https://damiangalarza.com/images/og-image.png"><meta name=twitter:image:alt content="Damian Galarza - Technical Partner & Fractional CTO"><meta property="article:author" content="Damian Galarza"><meta property="article:published_time" content="2012-04-02T00:00:00Z"><meta property="article:modified_time" content="2012-04-02T00:00:00Z"><meta property="article:tag" content="sinatra"><meta property="article:tag" content="api-development"><meta property="article:tag" content="cors"><meta property="article:tag" content="proxy-patterns"><meta property="article:tag" content="microservices"><meta property="article:tag" content="ruby"><meta name=author content="Damian Galarza"><meta name=article:author content="Damian Galarza"><meta name=article:published_time content="2012-04-02T00:00:00Z"><meta name=article:modified_time content="2012-04-02T00:00:00Z"><meta name=article:tag content="sinatra"><meta name=article:tag content="api-development"><meta name=article:tag content="cors"><meta name=article:tag content="proxy-patterns"><meta name=article:tag content="microservices"><meta name=article:tag content="ruby"><meta name=robots content="index, follow"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Simple Sinatra Service Proxy","description":"Use Sinatra to rapidly build a proxy for a service when you can\u0026rsquo;t make cross-origin AJAX requests in development.","author":{"@type":"Person","name":"Damian Galarza","url":"https:\/\/damiangalarza.com\/"},"publisher":{"@type":"Person","name":"Damian Galarza","url":"https:\/\/damiangalarza.com\/"},"datePublished":"2012-04-02T00:00:00Z","dateModified":"2012-04-02T00:00:00Z","url":"https:\/\/damiangalarza.com\/posts\/2012-04-02-simple-sinatra-service-proxy\/","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/damiangalarza.com\/posts\/2012-04-02-simple-sinatra-service-proxy\/"},"keywords":"[\"sinatra\",\"api-development\",\"cors\",\"proxy-patterns\",\"microservices\",\"ruby\"]"}</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel=stylesheet></head><body class="min-h-screen flex flex-col"><header class="fixed top-0 left-0 right-0 z-50 bg-[var(--color-dark-bg)]/95 backdrop-blur-sm"><nav class="max-w-7xl mx-auto px-6 lg:px-12 py-5"><div class="flex items-center justify-between"><a href=https://damiangalarza.com/ class="flex items-center gap-3"><img src=/images/logo-icon.svg alt class="h-6 w-6">
<img src=/images/logo.svg alt="Damian Galarza" class="h-4 w-auto">
</a><button id=menu-toggle class="md:hidden text-gray-400 hover:text-white" aria-label="Toggle mobile menu">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button><div id=menu class="hidden md:flex items-center gap-8"><a href=https://damiangalarza.com/#contact class="btn-primary text-sm">Contact me</a></div></div><div id=mobile-menu class="hidden md:hidden mt-4 pt-4 border-t border-gray-800"><div class="flex flex-col gap-4"><a href=https://damiangalarza.com/ class="text-gray-300 hover:text-white transition-colors">Home</a>
<a href=/posts/ class="text-gray-300 hover:text-white transition-colors">Blog</a>
<a href=https://damiangalarza.com/#contact class="text-gray-300 hover:text-white transition-colors">Contact me</a></div></div></nav></header><script>const menuToggle=document.getElementById("menu-toggle"),mobileMenu=document.getElementById("mobile-menu");menuToggle.addEventListener("click",()=>{mobileMenu.classList.toggle("hidden")})</script><div class=h-20></div><main class=flex-1><article class="py-20 px-6 lg:px-8"><div class="max-w-4xl mx-auto"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/damiangalarza.com\/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https:\/\/damiangalarza.com\/posts/"},{"@type":"ListItem","position":3,"name":"Simple Sinatra Service Proxy","item":"https:\/\/damiangalarza.com\/posts\/2012-04-02-simple-sinatra-service-proxy\/"}]}</script><nav aria-label=Breadcrumb class=mb-12><ol class="flex items-center gap-3 text-sm text-gray-400 min-w-0"><li><a href=https://damiangalarza.com/ class="hover:text-white transition-colors">Home</a></li><li class=text-gray-600><span>/</span></li><li><a href=/posts/ class="hover:text-white transition-colors">Blog</a></li><li class=text-gray-600><span>/</span></li><li class="text-gray-500 truncate" aria-current=page>Simple Sinatra Service Proxy</li></ol></nav><header class=mb-12><h1 class="text-4xl md:text-5xl font-bold mb-4">Simple Sinatra Service Proxy</h1><div class="flex items-center gap-4 text-gray-400"><time datetime=2012-04-02>April 2, 2012</time>
<span>•</span>
<span>3 min read</span></div><div class="flex gap-2 mt-4 flex-wrap"><a href=/tags/sinatra class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">sinatra
</a><a href=/tags/api-development class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">api-development
</a><a href=/tags/cors class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">cors
</a><a href=/tags/proxy-patterns class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">proxy-patterns
</a><a href=/tags/microservices class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">microservices
</a><a href=/tags/ruby class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">ruby</a></div></header><div class="prose prose-invert prose-lg max-w-none"><p>Recently I came across the situation where I would need to communicate with a third party API on the front
end via JavaScript and some AJAX requests. Unfortunately JavaScript does not allow ajax requests across different
domains which caused an issue for us since the service does not support a JSONP service to get around this.</p><p>Instead, I set out to build a back end service which would consume our third party API and we could interact
with on the front end. However, I did not want to spend a great deal of time on building this midpoint between
the services.</p><h3 id=ruby-and-sinatra-to-the-rescue>Ruby and Sinatra to the Rescue</h3><p>Armed with the task at hand I set out to build the simplest approach possible to begin consuming our third party
API as quickly as possible. I started out with Rails and a look into ActiveResource but quickly found that there was
to much overhead and complexity for what I needed. With this in mind I decided to move onto a simple Sinatra application which
would aim to mimic the third party services in API methods and forward requests for us.</p><p>For our test case, let&rsquo;s look at the Twitter API. Note, Twitter does in fact support a JSONP service so this isn&rsquo;t really necessary.
We are simply using it as a test case for the post.</p><h4 id=fetching-a-users-timeline>Fetching a user&rsquo;s timeline</h4><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#89dceb>require</span> <span style=color:#a6e3a1>&#39;sintra&#39;</span>
</span></span><span style=display:flex><span><span style=color:#89dceb>require</span> <span style=color:#a6e3a1>&#39;net/http&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get <span style=color:#a6e3a1>&#34;/1/statuses/user_timeline&#34;</span> <span style=color:#cba6f7>do</span>
</span></span><span style=display:flex><span>    uri <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>URI</span><span style=color:#89dceb;font-weight:700>::</span><span style=color:#f9e2af>HTTP</span><span style=color:#89dceb;font-weight:700>.</span>build(
</span></span><span style=display:flex><span>        <span style=color:#a6e3a1>:host</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> api<span style=color:#89dceb;font-weight:700>.</span>twitter<span style=color:#89dceb;font-weight:700>.</span>com,
</span></span><span style=display:flex><span>        <span style=color:#a6e3a1>:path</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> request<span style=color:#89dceb;font-weight:700>.</span>path_info,
</span></span><span style=display:flex><span>        <span style=color:#a6e3a1>:query</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> request<span style=color:#89dceb;font-weight:700>.</span>query_string
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    content_type <span style=color:#a6e3a1>&#39;application/json&#39;</span>, <span style=color:#a6e3a1>:charset</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>&#39;utf-8&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f9e2af>Net</span><span style=color:#89dceb;font-weight:700>::</span><span style=color:#f9e2af>HTTP</span><span style=color:#89dceb;font-weight:700>.</span>get(uri)
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p>In order to fetch a user&rsquo;s timeline we will need to make a request to the following API path: <code>/1/statuses/user_timeline</code>. Along with this path
the API documentation by twitter specifies that we can send various parameters along in the query string. What we have done here is we created a path which matches
twitter&rsquo;s and from there we access the request information provided by Sinatra. We build a URI using the API URL, <code>request.path</code>, and <code>request.query</code>. This will allow us
to quickly forward the request to Twitter&rsquo;s API through a NET::HTTP.get request.</p><p>Now that we&rsquo;ve done that we can either mount our Sinatra app somewhere in the same domain or proxy requests to it on another domain. In my case, I&rsquo;ve set up a simple
proxy through Apache at /services.</p><pre tabindex=0><code>&lt;IfModule mod_proxy.c&gt;
    ProxyRequests Off
    ProxyVia On

    &lt;Proxy *&gt;
        AddDefaultCharset off
        Order deny, allow
        Allow from all
    &lt;/Proxy&gt;

    ProxyPass /services http://127.0.0.1:9393
    ProxyPassReverse /services http://127.0.0.1:9393
&lt;/IfModule&gt;
</code></pre><p>So assuming I have my Sinatra application up and running on port 9393. I now have a proxy which will forward all requests to /services in my web application
to the Sinatra application. This will then forward all requests to the Twitter API and return the results. Visit the <a href=http://httpd.apache.org/docs/2.0/mod/mod_proxy.html>mod_proxy</a> documentation
for more information about HTTP proxies with Apache.</p><h4 id=drying-up-our-application>Drying up our application</h4><p>In our case right now we have a single method that we are forwarding, but what if we wanted to support more API methods provided by twitter. Well we could go ahead and write out
each method and its block, or we could take advantage of the flexibility we have available to us.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#89dceb>require</span> <span style=color:#a6e3a1>&#39;sinatra&#39;</span>
</span></span><span style=display:flex><span><span style=color:#89dceb>require</span> <span style=color:#a6e3a1>&#39;net/http&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>def</span> <span style=color:#89b4fa>api_request</span>(path, query_string)
</span></span><span style=display:flex><span>    uri <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>URI</span><span style=color:#89dceb;font-weight:700>::</span><span style=color:#f9e2af>HTTP</span><span style=color:#89dceb;font-weight:700>.</span>build(
</span></span><span style=display:flex><span>        <span style=color:#a6e3a1>:host</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> api<span style=color:#89dceb;font-weight:700>.</span>twitter<span style=color:#89dceb;font-weight:700>.</span>com,
</span></span><span style=display:flex><span>        <span style=color:#a6e3a1>:path</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> path,
</span></span><span style=display:flex><span>        <span style=color:#a6e3a1>:query</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> query_string
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f9e2af>Net</span><span style=color:#89dceb;font-weight:700>::</span><span style=color:#f9e2af>HTTP</span><span style=color:#89dceb;font-weight:700>.</span>get uri
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>request_handler <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#89dceb;font-weight:700>-&gt;</span> <span style=color:#cba6f7>do</span>
</span></span><span style=display:flex><span>    content_type <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#a6e3a1>&#39;application/json&#39;</span>, <span style=color:#a6e3a1>:charset</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>&#39;utf-8&#39;</span>
</span></span><span style=display:flex><span>    api_request request<span style=color:#89dceb;font-weight:700>.</span>path_info, request<span style=color:#89dceb;font-weight:700>.</span>query_string
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e3a1>%w{
</span></span></span><span style=display:flex><span><span style=color:#a6e3a1>    /1/statues/user_timeline
</span></span></span><span style=display:flex><span><span style=color:#a6e3a1>    /1/statuses/mentions
</span></span></span><span style=display:flex><span><span style=color:#a6e3a1>    /1/statuses/retweeted_by_me
</span></span></span><span style=display:flex><span><span style=color:#a6e3a1>}</span><span style=color:#89dceb;font-weight:700>.</span>each { <span style=color:#89dceb;font-weight:700>|</span>route<span style=color:#89dceb;font-weight:700>|</span> get route, <span style=color:#89dceb;font-weight:700>&amp;</span>request_handler }
</span></span></code></pre></div></div><footer class="mt-16 pt-8 border-t border-gray-800"><div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"><a href=https://damiangalarza.com/posts/2010-12-27-bringing-back-the-image-map/ class=group><span class="text-sm text-gray-500 group-hover:text-gray-400">← Previous</span><h3 class="font-semibold group-hover:text-[var(--color-accent-teal)] transition-colors">Bringing back the image map</h3></a><a href=https://damiangalarza.com/posts/2012-04-02-site-relaunch/ class="group text-right"><span class="text-sm text-gray-500 group-hover:text-gray-400">Next →</span><h3 class="font-semibold group-hover:text-[var(--color-accent-teal)] transition-colors">Site Relaunch</h3></a></div></footer></div></article></main><footer class="border-t border-gray-800 py-8 px-6 lg:px-8 section-alt flex items-center min-h-[120px]"><div class="max-w-6xl mx-auto w-full"><div class="flex flex-col md:flex-row justify-between items-center gap-4"><div class="text-center md:text-left"><div class="w-16 h-0.5 bg-[var(--color-accent-teal)] mb-3 mx-auto md:mx-0"></div><p class="text-sm text-gray-500">Ready to build something great together?</p><p class="text-xs text-gray-500 mt-2">© 2025 Damian Galarza. All rights reserved.</p></div><div class="flex items-center gap-6"><a href=https://www.linkedin.com/in/dgalarza/ target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="LinkedIn profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 0H5C2.239.0.0 2.239.0 5v14c0 2.761 2.239 5 5 5h14c2.762.0 5-2.239 5-5V5c0-2.761-2.238-5-5-5zM8 19H5V8h3v11zM6.5 6.732c-.966.0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zM20 19h-3v-5.604c0-3.368-4-3.113-4 0V19h-3V8h3v1.765c1.396-2.586 7-2.777 7 2.476V19z"/></svg>
</a><a href=https://github.com/dgalarza target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="GitHub profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
</a><a href=https://twitter.com/dgalarza target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="Twitter profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div></div></div></footer></body></html>