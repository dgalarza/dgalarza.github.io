<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>A look at Decorators and Presenters - Technical Partner for Startups | Damian Galarza, Fractional CTO</title><meta name=description content="A look at how decorators and presenters can give flexibility to your application."><link rel=stylesheet href=/css/style.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-5Y6WCB7SKQ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5Y6WCB7SKQ")</script><link rel=icon href=/favicon.ico><link rel=canonical href=https://damiangalarza.com/posts/2012-10-03-a-look-at-decorators-and-presenters/><meta property="og:type" content="article"><meta property="og:title" content="A look at Decorators and Presenters"><meta property="og:description" content><meta property="og:url" content="https://damiangalarza.com/posts/2012-10-03-a-look-at-decorators-and-presenters/"><meta property="og:site_name" content="Technical Partner for Startups | Damian Galarza, Fractional CTO"><meta property="og:image" content="https://damiangalarza.com/images/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:image:alt" content="Damian Galarza - Technical Partner & Fractional CTO"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@dgalarza"><meta name=twitter:creator content="@dgalarza"><meta name=twitter:image content="https://damiangalarza.com/images/og-image.png"><meta name=twitter:image:alt content="Damian Galarza - Technical Partner & Fractional CTO"><meta property="article:author" content="Damian Galarza"><meta property="article:published_time" content="2012-10-03T16:38:27Z"><meta property="article:modified_time" content="2012-10-03T16:38:27Z"><meta property="article:tag" content="rails-architecture"><meta property="article:tag" content="design-patterns"><meta property="article:tag" content="decorators"><meta property="article:tag" content="presenters"><meta property="article:tag" content="code-organization"><meta property="article:tag" content="mvc"><meta property="article:section" content="Ruby on Rails"><meta name=author content="Damian Galarza"><meta name=article:author content="Damian Galarza"><meta name=article:published_time content="2012-10-03T16:38:27Z"><meta name=article:modified_time content="2012-10-03T16:38:27Z"><meta name=article:tag content="rails-architecture"><meta name=article:tag content="design-patterns"><meta name=article:tag content="decorators"><meta name=article:tag content="presenters"><meta name=article:tag content="code-organization"><meta name=article:tag content="mvc"><meta name=robots content="index, follow"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"A look at Decorators and Presenters","description":"A look at how decorators and presenters can give flexibility to your application.","author":{"@type":"Person","name":"Damian Galarza","url":"https:\/\/damiangalarza.com\/"},"publisher":{"@type":"Person","name":"Damian Galarza","url":"https:\/\/damiangalarza.com\/"},"datePublished":"2012-10-03T16:38:27Z","dateModified":"2012-10-03T16:38:27Z","url":"https:\/\/damiangalarza.com\/posts\/2012-10-03-a-look-at-decorators-and-presenters\/","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/damiangalarza.com\/posts\/2012-10-03-a-look-at-decorators-and-presenters\/"},"keywords":"[\"rails-architecture\",\"design-patterns\",\"decorators\",\"presenters\",\"code-organization\",\"mvc\"]"}</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel=stylesheet></head><body class="min-h-screen flex flex-col"><header class="fixed top-0 left-0 right-0 z-50 bg-[var(--color-dark-bg)]/95 backdrop-blur-sm"><nav class="max-w-7xl mx-auto px-6 lg:px-12 py-5"><div class="flex items-center justify-between"><a href=https://damiangalarza.com/ class="flex items-center gap-3"><img src=/images/logo-icon.svg alt class="h-6 w-6">
<img src=/images/logo.svg alt="Damian Galarza" class="h-4 w-auto">
</a><button id=menu-toggle class="md:hidden text-gray-400 hover:text-white" aria-label="Toggle mobile menu">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button><div id=menu class="hidden md:flex items-center gap-8"><a href=https://damiangalarza.com/#contact class="btn-primary text-sm">Contact me</a></div></div><div id=mobile-menu class="hidden md:hidden mt-4 pt-4 border-t border-gray-800"><div class="flex flex-col gap-4"><a href=https://damiangalarza.com/ class="text-gray-300 hover:text-white transition-colors">Home</a>
<a href=/posts/ class="text-gray-300 hover:text-white transition-colors">Blog</a>
<a href=https://damiangalarza.com/#contact class="text-gray-300 hover:text-white transition-colors">Contact me</a></div></div></nav></header><script>const menuToggle=document.getElementById("menu-toggle"),mobileMenu=document.getElementById("mobile-menu");menuToggle.addEventListener("click",()=>{mobileMenu.classList.toggle("hidden")})</script><div class=h-20></div><main class=flex-1><article class="py-20 px-6 lg:px-8"><div class="max-w-4xl mx-auto"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/damiangalarza.com\/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https:\/\/damiangalarza.com\/posts/"},{"@type":"ListItem","position":3,"name":"A look at Decorators and Presenters","item":"https:\/\/damiangalarza.com\/posts\/2012-10-03-a-look-at-decorators-and-presenters\/"}]}</script><nav aria-label=Breadcrumb class=mb-12><ol class="flex items-center gap-3 text-sm text-gray-400 min-w-0"><li><a href=https://damiangalarza.com/ class="hover:text-white transition-colors">Home</a></li><li class=text-gray-600><span>/</span></li><li><a href=/posts/ class="hover:text-white transition-colors">Blog</a></li><li class=text-gray-600><span>/</span></li><li class="text-gray-500 truncate" aria-current=page>A look at Decorators and Presenters</li></ol></nav><header class=mb-12><h1 class="text-4xl md:text-5xl font-bold mb-4">A look at Decorators and Presenters</h1><div class="flex items-center gap-4 text-gray-400"><time datetime=2012-10-03>October 3, 2012</time>
<span>•</span>
<span>8 min read</span></div><div class="flex gap-2 mt-4 flex-wrap"><a href=/tags/rails-architecture class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">rails-architecture
</a><a href=/tags/design-patterns class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">design-patterns
</a><a href=/tags/decorators class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">decorators
</a><a href=/tags/presenters class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">presenters
</a><a href=/tags/code-organization class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">code-organization
</a><a href=/tags/mvc class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">mvc</a></div></header><div class="prose prose-invert prose-lg max-w-none"><p>#Posts: Decorators and Presenters</p><p>As part of an effort to clean up some of the complexity behind the views with posts on QFive a major refactoring was done on our current &lsquo;presenters&rsquo; implementation.</p><p>Since starting on the project I and several others have often opened up the presenters with the distinct feeling of being lost. The next step usually was a look at the base Presenter class which usually helped but would leave us with a sinking feeling with what was going on.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#cba6f7>class</span> <span style=color:#f9e2af>Presenter</span> <span style=color:#89dceb;font-weight:700>&lt;</span> <span style=color:#f9e2af>BasicObject</span>
</span></span><span style=display:flex><span>  undef_method <span style=color:#a6e3a1>:==</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>initialize</span>(component)
</span></span><span style=display:flex><span>    <span style=color:#f5e0dc>@component</span> <span style=color:#89dceb;font-weight:700>=</span> component
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>method_missing</span>(<span style=color:#89dceb>name</span>, <span style=color:#89dceb;font-weight:700>*</span>args, <span style=color:#89dceb;font-weight:700>&amp;</span>block)
</span></span><span style=display:flex><span>    <span style=color:#f5e0dc>@component</span><span style=color:#89dceb;font-weight:700>.</span>send(<span style=color:#89dceb>name</span>, <span style=color:#89dceb;font-weight:700>*</span>args, <span style=color:#89dceb;font-weight:700>&amp;</span>block)
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>respond_to?</span>(method_id)
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>if</span> <span style=color:#f5e0dc>@component</span><span style=color:#89dceb;font-weight:700>.</span>respond_to?(method_id)
</span></span><span style=display:flex><span>      <span style=color:#cba6f7>true</span>
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>else</span>
</span></span><span style=display:flex><span>      <span style=color:#cba6f7>super</span>
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>send</span>(symbol, <span style=color:#89dceb;font-weight:700>*</span>args)
</span></span><span style=display:flex><span>    <span style=color:#89dceb>__send__</span>(symbol, <span style=color:#89dceb;font-weight:700>*</span>args)
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p>A quick look at the base presenter reveals a few things. First, it inherits from BasicObject rather than the typical Object class. Next, it goes a step further to undefine the == method for comparison purposes. We could probably simplify the implementation. Either way now with the project coming to life and knowing much more about the use cases we can revisit this and clean up.</p><h2 id=decorators-masked-as-presenters>Decorators masked as Presenters</h2><p>Another problem with our &lsquo;presenters&rsquo; is that they actually function as decorators. The topic of &lsquo;Decorators vs Presenters&rsquo; is usually widely debated and I have not seen one final answer that seems to be accepted. However The decorator pattern is one of the original GoF design patterns. However, the decorator pattern does have an accepted definition, wikipedia defines it as:</p><p>&lsquo;The decorator pattern can be used to extend (decorate) the functionality of a certain object at run-time, independently of other instances of the same class, provided some groundwork is done at design time. This is achieved by designing a new decorator class that wraps the original class.&rsquo;</p><p>While the presenter pattern is often found as part of the &lsquo;Model-View-Presenter&rsquo; pattern where the &lsquo;all presentation logic is pushed to the presenter&rsquo;.</p><h2 id=single-responsibility-principle>Single Responsibility Principle</h2><p>One thing was clear on the Presenters we had in place for posts. They were responsible for way to much. Our single Post presenter class (and any subsets of it) were responsible for:</p><ol><li>Generating a hash which represents a post for sending it to Facebook in a share for &lsquo;post to facebook&rsquo; functionality.</li><li>Generating a tweet text for sharing a post directly to Twitter.</li><li>Generating open graph tags for TwitterCards</li><li>Determining SOME open graph tags for Facebook (but not all)</li><li>Some minor post presentation updates for the view</li><li>Determining how to display a title of a post for the view (is it a topic your following? is it a team post? is it a repost?)</li></ol><p>and more</p><h2 id=view-coupling-with-presenters>View Coupling with Presenters</h2><p>Next up, some weird coupling and usage in the view.</p><p>If a presenter is intended for view logic, then why was our only usage of a presenter within app/views/posts/show.html.slim this:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#89dceb;font-weight:700>-</span> presenter <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>PostPresenter</span><span style=color:#89dceb;font-weight:700>.</span>present(<span style=color:#f5e0dc>@post</span>, <span style=color:#89dceb>self</span>, <span style=color:#cba6f7>true</span>)
</span></span><span style=display:flex><span><span style=color:#89dceb;font-weight:700>-</span> content_for <span style=color:#a6e3a1>:title</span>, truncate(<span style=color:#f5e0dc>@post</span><span style=color:#89dceb;font-weight:700>.</span>text, <span style=color:#a6e3a1>:length</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#fab387>17</span>, <span style=color:#a6e3a1>:separator</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>&#39; &#39;</span>)<span style=color:#89dceb;font-weight:700>.</span>html_safe <span style=color:#cba6f7>if</span> <span style=color:#f5e0dc>@post</span><span style=color:#89dceb;font-weight:700>.</span>text
</span></span><span style=display:flex><span><span style=color:#89dceb;font-weight:700>-</span> content_for <span style=color:#a6e3a1>:og_title</span>, truncate(<span style=color:#f5e0dc>@post</span><span style=color:#89dceb;font-weight:700>.</span>text, <span style=color:#a6e3a1>:length</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#fab387>17</span>, <span style=color:#a6e3a1>:separator</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>&#39; &#39;</span>)<span style=color:#89dceb;font-weight:700>.</span>html_safe <span style=color:#cba6f7>if</span> <span style=color:#f5e0dc>@post</span><span style=color:#89dceb;font-weight:700>.</span>text
</span></span><span style=display:flex><span><span style=color:#89dceb;font-weight:700>-</span> content_for <span style=color:#a6e3a1>:og_type</span>, <span style=color:#a6e3a1>&#34;website&#34;</span>
</span></span><span style=display:flex><span><span style=color:#89dceb;font-weight:700>-</span> content_for <span style=color:#a6e3a1>:prefix</span>, <span style=color:#a6e3a1>&#34;og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object#&#34;</span>
</span></span></code></pre></div><p>There was no other reference to the presenter in the view. Another sign of failing SRP and coupling.</p><h2 id=cleaning-up>Cleaning up</h2><p>Before diving in I looked around into a few different solutions which all pointed back to <a href=https://github.com/jcasimir/draper>Draper</a> so I figured we would give it a shot. With a large amount of refactoring and cleaning up ahead of me I set out with the following goals:</p><ol><li>Follow SRP, don&rsquo;t end up with one massive class which is responsible for presenting a post for every possible situation.</li><li>Extensibility: We have many different places for posts: mobile, the web application, sharing on Facebook, Sharing on Twitter. We should be able to provide flexibility for this. We even have different sources or destinations: clubs, teams, topics. Extensibility and flexibility were key. I will elaborate on this later.</li></ol><p>Cleaning up also did not mean that we needed to drop presenters in favor of decorators or vice versa. Rather, understand their differences and build on each of their strengths. It&rsquo;s important to not mask a decorator as a presenter. Looking in the application now we can find 2 folders: app/decorators and app/presenters.</p><p>So, when should you be using a decorator and when should you be using a presenter? Simply follow these 2 guidelines:</p><p>First, are you just augmenting functionality, whether or not it&rsquo;s related to the view? Use a decorator.</p><p>Take for example our use of cache keys for post partials. Posts can appear in either a user&rsquo;s news feed or their profile / activity feed. Post partials are cached for each user viewing them but we must cache them differently based on whether they are a repost, or which feed they appear in. Enter the decorator.</p><p>Within app/views/posts/_post.html.slim</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#89dceb;font-weight:700>-</span> cache post<span style=color:#89dceb;font-weight:700>.</span>partial_cache_key(<span style=color:#a6e3a1>:activity_stream</span>, cache_key, current_user)  <span style=color:#cba6f7>do</span>  
</span></span><span style=display:flex><span>  div <span style=color:#89dceb>id</span><span style=color:#89dceb;font-weight:700>=</span><span style=color:#a6e3a1>&#34;post_</span><span style=color:#a6e3a1>#{</span>post<span style=color:#89dceb;font-weight:700>.</span>id<span style=color:#a6e3a1>}</span><span style=color:#a6e3a1>&#34;</span> class<span style=color:#89dceb;font-weight:700>=</span><span style=color:#a6e3a1>&#34;post&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#89dceb;font-weight:700>...</span>
</span></span></code></pre></div><p>app/decorators/post_decorator.rb</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span> <span style=color:#6c7086;font-style:italic># Advanced handling for generating an array for the cache key. A repost must be cached</span>
</span></span><span style=display:flex><span> <span style=color:#6c7086;font-style:italic># separately from the original post but it&#39;s own cache must be cleared when a user acts</span>
</span></span><span style=display:flex><span> <span style=color:#6c7086;font-style:italic># upon the original post such as a like or a repost</span>
</span></span><span style=display:flex><span> <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>partial_cache_key</span>(<span style=color:#89dceb;font-weight:700>*</span>segments)
</span></span><span style=display:flex><span>   segments <span style=color:#89dceb;font-weight:700>&lt;&lt;</span> model
</span></span><span style=display:flex><span>   <span style=color:#cba6f7>if</span> model<span style=color:#89dceb;font-weight:700>.</span>is_a_repost?
</span></span><span style=display:flex><span>     segments <span style=color:#89dceb;font-weight:700>&lt;&lt;</span> model<span style=color:#89dceb;font-weight:700>.</span>source
</span></span><span style=display:flex><span>   <span style=color:#cba6f7>end</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   segments
</span></span><span style=display:flex><span> <span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p>This allows us to handle reposts transparently to the view.</p><p>Second, are you taking something and drastically providing different logic for the view? Use a presenter.</p><p>A perfect example of a presenter in use in QFive is the notifications presenter. This presenter is not aiming to add additional logic behind the notification based on it&rsquo;s use. It does not provide any value other than providing presentation on the view while handling its polymorphic roots.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#cba6f7>class</span> <span style=color:#f9e2af>NotificationPresenter</span> <span style=color:#89dceb;font-weight:700>&lt;</span> <span style=color:#f9e2af>Presenter</span>                                                                                                                                                                                                                                                                                                                                     
</span></span><span style=display:flex><span>                                                                                                                                                                                                                                                                                                                                                                            
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>class</span> <span style=color:#89dceb;font-weight:700>&lt;&lt;</span> <span style=color:#89dceb>self</span>                                                                                                                                                                                                                                                                                                                                                             
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>present</span>(notification, context <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#cba6f7>nil</span>)                                                                                                                                                                                                                                                                                                                                
</span></span><span style=display:flex><span>      presenter <span style=color:#89dceb;font-weight:700>=</span> presenter_for(notification)<span style=color:#89dceb;font-weight:700>.</span>new(notification, context)                                                                                                                                                                                                                                                                                                    
</span></span><span style=display:flex><span>      presenter<span style=color:#89dceb;font-weight:700>.</span>present                                                                                                                                                                                                                                                                                                                                                     
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>end</span>                                                                                                                                                                                                                                                                                                                                                                     
</span></span><span style=display:flex><span>                                                                                                                                                                                                                                                                                                                                                                            
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>presenter_for</span>(notification)                                                                                                                                                                                                                                                                                                                                         
</span></span><span style=display:flex><span>      <span style=color:#a6e3a1>&#34;</span><span style=color:#a6e3a1>#{</span>notification<span style=color:#89dceb;font-weight:700>.</span>notifiable_type<span style=color:#a6e3a1>}</span><span style=color:#a6e3a1>_notification_presenter&#34;</span><span style=color:#89dceb;font-weight:700>.</span>classify<span style=color:#89dceb;font-weight:700>.</span>safe_constantize <span style=color:#89dceb;font-weight:700>||</span> <span style=color:#f9e2af>NotificationPresenter</span>                                                                                                                                                                                                                                                           
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>end</span>                                                                                                                                                                                                                                                                                                                                                                     
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>                                                                                                                                                                                                                                                                                                                                                                       
</span></span><span style=display:flex><span>                                                                                                                                                                                                                                                                                                                                                                            
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>initialize</span>(notification, context <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#cba6f7>nil</span>)                                                                                                                                                                                                                                                                                                                               
</span></span><span style=display:flex><span>    <span style=color:#f5e0dc>@notification</span> <span style=color:#89dceb;font-weight:700>=</span> notification                                                                                                                                                                                                                                                                                                                                            
</span></span><span style=display:flex><span>    <span style=color:#f5e0dc>@context</span> <span style=color:#89dceb;font-weight:700>=</span> context                                                                                                                                                                                                                                                                                                                                                      
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>                                                                                                                                                                                                                                                                                                                                                                       
</span></span><span style=display:flex><span>                                                                                                                                                                                                                                                                                                                                                                            
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>present</span>                                                                                                                                                                                                                                                                                                                                                               
</span></span><span style=display:flex><span>    sender_avatar_link <span style=color:#89dceb;font-weight:700>+</span> notification_presentation                                                                                                                                                                                                                                                                                                                          
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span> 
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#f38ba8>…</span>
</span></span></code></pre></div><p>QFive has notifications for many things like comments, likes, follows, reposts, etc. and we have a sinple page which lists out the various notifications you can receive. There needs to be a way to transform a universal &lsquo;Notification&rsquo; object for viewing purposes to the user. We could have a view littered with if else blocks which would quickly become a nightmare to maintain. Or we could abstract this into a presenter.</p><p>In our view you can find a simple partial for handling notifications:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#89dceb;font-weight:700>.</span>media
</span></span><span style=display:flex><span>	<span style=color:#89dceb;font-weight:700>=</span> notification_message(notification)
</span></span></code></pre></div><p>This in turn calls a helper method:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#cba6f7>def</span> <span style=color:#89b4fa>notification_message</span>(notification)
</span></span><span style=display:flex><span>	<span style=color:#f9e2af>NotificationPresenter</span><span style=color:#89dceb;font-weight:700>.</span>present(notification, <span style=color:#89dceb>self</span>)<span style=color:#89dceb;font-weight:700>.</span>html_safe
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p>So we simply output the results of the notification presenter to the view. Taking a look at the present method, we simply generate an avatar link for the sender of the notification and then a call to notification_presentation which can then proxy based off the different types of notifications:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>notification_presentation</span>                                                                                                                                                                                                                                                                                                                                             
</span></span><span style=display:flex><span>    klass <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#a6e3a1>&#39;bd&#39;</span>                                                                                                                                                                                                                                                                                                                                                            
</span></span><span style=display:flex><span>    <span style=color:#89dceb>method</span> <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f5e0dc>@notification</span><span style=color:#89dceb;font-weight:700>.</span>notifiable_type<span style=color:#89dceb;font-weight:700>.</span>underscore<span style=color:#89dceb;font-weight:700>.</span>downcase <span style=color:#89dceb;font-weight:700>+</span> <span style=color:#a6e3a1>&#39;_notification&#39;</span>                                                                                                                                                                                                                                                                                            
</span></span><span style=display:flex><span>    message <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#89dceb>self</span><span style=color:#89dceb;font-weight:700>.</span>send(<span style=color:#89dceb>method</span><span style=color:#89dceb;font-weight:700>.</span>to_sym)                                                                                                                                                                                                                                                                                                                                      
</span></span><span style=display:flex><span>                                                                                                                                                                                                                                                                                                                                                                            
</span></span><span style=display:flex><span>    content_tag(<span style=color:#a6e3a1>:div</span>, <span style=color:#a6e3a1>class</span>: klass) <span style=color:#cba6f7>do</span>                                                                                                                                                                                                                                                                                                                                      
</span></span><span style=display:flex><span>      link_to(<span style=color:#f5e0dc>@notification</span><span style=color:#89dceb;font-weight:700>.</span>sender<span style=color:#89dceb;font-weight:700>.</span>name, <span style=color:#f5e0dc>@notification</span><span style=color:#89dceb;font-weight:700>.</span>sender) <span style=color:#89dceb;font-weight:700>+</span> <span style=color:#a6e3a1>&#39; &#39;</span> <span style=color:#89dceb;font-weight:700>+</span> message<span style=color:#89dceb;font-weight:700>.</span>html_safe                                                                                                                                                                                                                                                                                    
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>end</span>                                                                                                                                                                                                                                                                                                                                                                     
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>  
</span></span></code></pre></div><p>From here, we simply determine the kind of notification that is being presented (comment, follow, etc) and delegate to a method matching the convention <code>#{notifialbe_type.underscore.downcase}_notification</code> which for example in the scenario of a repost will call:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#cba6f7>def</span> <span style=color:#89b4fa>repost_notification</span>                                                                                                                                                                                                                                                                                                                                                   
</span></span><span style=display:flex><span>  <span style=color:#a6e3a1>&#34;reposted </span><span style=color:#a6e3a1>#{</span>notification_for_post<span style=color:#a6e3a1>}</span><span style=color:#a6e3a1>&#34;</span>                                                                                                                                                                                                                                                                                                                                     
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p>We can also abstract logic for the following conditions:</p><ul><li>A user reposts a post for a club that I manage</li><li>A user reposts a post for a post I made</li></ul><p>With the various targets and receivers for a notification the permutations behind the kinds of ways a simple notification can be presented grows quickly.</p><h2 id=flexibility>Flexibility</h2><p>One last topic I will cover is the flexibility that the decorators provide. Let&rsquo;s take a scenario for a post which is posted within a topic that I follow. Assuming I do not follow the user but rather the post shows up in my newsfeed because I follow the topic, I should see the post with the common &ldquo;Josh has posted in a topic you follow&rdquo;. This seems straightfoward enough. However if we start to think of the use case of visiting Josh&rsquo;s profile it no longer makes sense to display that heading. We are viewing this post in the context of Josh&rsquo;s profile rather than in our newsfeed, therefor &ldquo;Josh posted in a topic that you follow&rdquo; has lost its context in this view.</p><p>Enter feeds.</p><p>I will not get into the details of feeds in this post, but instead I will cover some background. A feed is a collection of posts to view on a page. There are different kinds of feeds, NewsFeed&rsquo;s which cover the case of displaying posts in your news feed when you log in, and activity feeds which pulls in content for a user or club, or team.</p><p>Since these feeds act as a context point towards the kinds of posts you are viewing at the time, we can inject decorators into the scene in order to provide flexibility for us.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#6c7086;font-style:italic># NewsFeed</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>def</span> <span style=color:#89b4fa>decorated_posts</span>                                                                                                                                                                                                                                                                                                                                                       
</span></span><span style=display:flex><span>  <span style=color:#f9e2af>NewsFeedPostDecorator</span><span style=color:#89dceb;font-weight:700>.</span>decorate posts                                                                                                                                                                                                                                                                                                                                    
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>     
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic># ActivityFeed</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>def</span> <span style=color:#89b4fa>decorated_posts</span>                                                                                                                                                                                                                                                                                                                                                       
</span></span><span style=display:flex><span>  <span style=color:#f9e2af>PostDecorator</span><span style=color:#89dceb;font-weight:700>.</span>decorate posts                                                                                                                                                                                                                                                                                                                                            
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p>The view is no longer concerned with how to display a post within a news feed or an activity feed. Instead the view simply can call post.title and it will have the proper title generated.</p><p>For example, within NewsFeedPostDecorator:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>title</span>                                                                                                                                                                                                                                                                                                                                                                 
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>if</span> model<span style=color:#89dceb;font-weight:700>.</span>is_a_repost?                                                                                                                                                                                                                                                                                                                                                   
</span></span><span style=display:flex><span>      repost_title                                                                                                                                                                                                                                                                                                                                                          
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>elsif</span> model<span style=color:#89dceb;font-weight:700>.</span>team_post?                                                                                                                                                                                                                                                                                                                                                  
</span></span><span style=display:flex><span>      team_post_title                                                                                                                                                                                                                                                                                                                                                       
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>elsif</span> followed_topic?                                                                                                                                                                                                                                                                                                                                                   
</span></span><span style=display:flex><span>      topic_post_title                                                                                                                                                                                                                                                                                                                                                      
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>else</span>                                                                                                                                                                                                                                                                                                                                                                    
</span></span><span style=display:flex><span>      generic_title                                                                                                                                                                                                                                                                                                                                                         
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>end</span>                                                                                                                                                                                                                                                                                                                                                                     
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span> 
</span></span></code></pre></div><p>And then in PostDecorator:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#cba6f7>def</span> <span style=color:#89b4fa>title</span>                                                                                                                                                                                                                                                                                                                                                                 
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>if</span> model<span style=color:#89dceb;font-weight:700>.</span>is_a_repost?                                                                                                                                                                                                                                                                                                                                                   
</span></span><span style=display:flex><span>    repost_title                                                                                                                                                                                                                                                                                                                                                          
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>else</span>                                                                                                                                                                                                                                                                                                                                                                    
</span></span><span style=display:flex><span>    generic_title                                                                                                                                                                                                                                                                                                                                                         
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>                                                                                                                                                                                                                                                                                                                                                                     
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>   
</span></span></code></pre></div></div><footer class="mt-16 pt-8 border-t border-gray-800"><div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"><a href=https://damiangalarza.com/posts/2012-09-05-newrelic-rpm-with-actioncontroller-metal/ class=group><span class="text-sm text-gray-500 group-hover:text-gray-400">← Previous</span><h3 class="font-semibold group-hover:text-[var(--color-accent-teal)] transition-colors">NewRelic RPM with ActionController::Metal</h3></a><a href=https://damiangalarza.com/posts/2013-10-18-changing-git-remotes-and-capistrano/ class="group text-right"><span class="text-sm text-gray-500 group-hover:text-gray-400">Next →</span><h3 class="font-semibold group-hover:text-[var(--color-accent-teal)] transition-colors">Changing Git Remotes and Capistrano</h3></a></div></footer></div></article></main><footer class="border-t border-gray-800 py-8 px-6 lg:px-8 section-alt flex items-center min-h-[120px]"><div class="max-w-6xl mx-auto w-full"><div class="flex flex-col md:flex-row justify-between items-center gap-4"><div class="text-center md:text-left"><div class="w-16 h-0.5 bg-[var(--color-accent-teal)] mb-3 mx-auto md:mx-0"></div><p class="text-sm text-gray-500">Ready to build something great together?</p><p class="text-xs text-gray-500 mt-2">© 2025 Damian Galarza. All rights reserved.</p></div><div class="flex items-center gap-6"><a href=https://www.linkedin.com/in/dgalarza/ target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="LinkedIn profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 0H5C2.239.0.0 2.239.0 5v14c0 2.761 2.239 5 5 5h14c2.762.0 5-2.239 5-5V5c0-2.761-2.238-5-5-5zM8 19H5V8h3v11zM6.5 6.732c-.966.0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zM20 19h-3v-5.604c0-3.368-4-3.113-4 0V19h-3V8h3v1.765c1.396-2.586 7-2.777 7 2.476V19z"/></svg>
</a><a href=https://github.com/dgalarza target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="GitHub profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
</a><a href=https://twitter.com/dgalarza target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="Twitter profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div></div></div></footer></body></html>