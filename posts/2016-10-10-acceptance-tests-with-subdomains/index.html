<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Acceptance Tests with Subdomains - Damian Galarza | Technical Partner for Startups & Fractional CTO</title><meta name=description content="How to use subdomains in your feature specs."><link rel=stylesheet href=/css/style.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-5Y6WCB7SKQ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5Y6WCB7SKQ")</script><link rel=icon href=/favicon.ico><link rel=canonical href=https://damiangalarza.com/posts/2016-10-10-acceptance-tests-with-subdomains/><meta property="og:type" content="article"><meta property="og:title" content="Acceptance Tests with Subdomains"><meta property="og:description" content="How to use subdomains in your feature specs."><meta property="og:url" content="https://damiangalarza.com/posts/2016-10-10-acceptance-tests-with-subdomains/"><meta property="og:site_name" content="Damian Galarza | Technical Partner for Startups & Fractional CTO"><meta property="og:image" content="https://damiangalarza.com/images/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:image:alt" content="Damian Galarza - Technical Partner & Fractional CTO"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@dgalarza"><meta name=twitter:creator content="@dgalarza"><meta name=twitter:image content="https://damiangalarza.com/images/og-image.png"><meta name=twitter:image:alt content="Damian Galarza - Technical Partner & Fractional CTO"><meta property="article:author" content="Damian Galarza"><meta property="article:published_time" content="2016-10-10T00:00:00Z"><meta property="article:modified_time" content="2016-10-10T00:00:00Z"><meta property="article:tag" content="web-development"><meta property="article:tag" content="rails"><meta property="article:tag" content="ruby"><meta property="article:tag" content="testing"><meta property="article:tag" content="tutorial"><meta name=author content="Damian Galarza"><meta name=article:author content="Damian Galarza"><meta name=article:published_time content="2016-10-10T00:00:00Z"><meta name=article:modified_time content="2016-10-10T00:00:00Z"><meta name=article:tag content="web-development"><meta name=article:tag content="rails"><meta name=article:tag content="ruby"><meta name=article:tag content="testing"><meta name=article:tag content="tutorial"><meta name=robots content="index, follow"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Acceptance Tests with Subdomains","description":"How to use subdomains in your feature specs.","author":{"@type":"Person","name":"Damian Galarza","url":"https:\/\/damiangalarza.com\/"},"publisher":{"@type":"Person","name":"Damian Galarza","url":"https:\/\/damiangalarza.com\/"},"datePublished":"2016-10-10T00:00:00Z","dateModified":"2016-10-10T00:00:00Z","url":"https:\/\/damiangalarza.com\/posts\/2016-10-10-acceptance-tests-with-subdomains\/","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/damiangalarza.com\/posts\/2016-10-10-acceptance-tests-with-subdomains\/"},"keywords":"[\"web-development\",\"rails\",\"ruby\",\"testing\",\"tutorial\"]"}</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel=stylesheet></head><body class="min-h-screen flex flex-col"><header class="fixed top-0 left-0 right-0 z-50 bg-[var(--color-dark-bg)]/95 backdrop-blur-sm"><nav class="max-w-7xl mx-auto px-6 lg:px-12 py-5"><div class="flex items-center justify-between"><a href=https://damiangalarza.com/ class="flex items-center gap-3"><img src=/images/logo-icon.svg alt class="h-6 w-6">
<img src=/images/logo.svg alt="Damian Galarza" class="h-4 w-auto">
</a><button id=menu-toggle class="md:hidden text-gray-400 hover:text-white" aria-label="Toggle mobile menu">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button><div id=menu class="hidden md:flex items-center gap-8"><a href=https://damiangalarza.com/#contact class="btn-primary text-sm">Contact me</a></div></div><div id=mobile-menu class="hidden md:hidden mt-4 pt-4 border-t border-gray-800"><div class="flex flex-col gap-4"><a href=https://damiangalarza.com/ class="text-gray-300 hover:text-white transition-colors">Home</a>
<a href=/posts/ class="text-gray-300 hover:text-white transition-colors">Blog</a>
<a href=https://damiangalarza.com/#contact class="text-gray-300 hover:text-white transition-colors">Contact me</a></div></div></nav></header><script>const menuToggle=document.getElementById("menu-toggle"),mobileMenu=document.getElementById("mobile-menu");menuToggle.addEventListener("click",()=>{mobileMenu.classList.toggle("hidden")})</script><div class=h-20></div><main class=flex-1><article class="py-20 px-6 lg:px-8"><div class="max-w-4xl mx-auto"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/damiangalarza.com\/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https:\/\/damiangalarza.com\/posts/"},{"@type":"ListItem","position":3,"name":"Acceptance Tests with Subdomains","item":"https:\/\/damiangalarza.com\/posts\/2016-10-10-acceptance-tests-with-subdomains\/"}]}</script><nav aria-label=Breadcrumb class=mb-12><ol class="flex items-center gap-3 text-sm text-gray-400 min-w-0"><li><a href=https://damiangalarza.com/ class="hover:text-white transition-colors">Home</a></li><li class=text-gray-600><span>/</span></li><li><a href=/posts/ class="hover:text-white transition-colors">Blog</a></li><li class=text-gray-600><span>/</span></li><li class="text-gray-500 truncate" aria-current=page>Acceptance Tests with Subdomains</li></ol></nav><header class=mb-12><h1 class="text-4xl md:text-5xl font-bold mb-4">Acceptance Tests with Subdomains</h1><div class="flex items-center gap-4 text-gray-400"><time datetime=2016-10-10>October 10, 2016</time>
<span>•</span>
<span>4 min read</span></div><div class="flex gap-2 mt-4 flex-wrap"><a href=/tags/web-development class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">web-development
</a><a href=/tags/rails class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">rails
</a><a href=/tags/ruby class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">ruby
</a><a href=/tags/testing class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">testing
</a><a href=/tags/tutorial class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">tutorial</a></div></header><div class="prose prose-invert prose-lg max-w-none"><p>This post was originally published on the <a href=https://thoughtbot.com/blog/acceptance-tests-with-subdomains>thoughtbot blog</a>.</p><p>You&rsquo;re excited about building a new application which allows users to sign up and host their own blog. You decide that each blog will have their own space by providing a subdomain.</p><p>Let&rsquo;s start off with a feature spec.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#89dceb>require</span> <span style=color:#a6e3a1>&#34;rails_helper&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>feature <span style=color:#a6e3a1>&#34;user views a blog&#34;</span> <span style=color:#cba6f7>do</span>
</span></span><span style=display:flex><span>  scenario <span style=color:#a6e3a1>&#34;homepage&#34;</span> <span style=color:#cba6f7>do</span>
</span></span><span style=display:flex><span>     blog <span style=color:#89dceb;font-weight:700>=</span> create(
</span></span><span style=display:flex><span>      <span style=color:#a6e3a1>:blog</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e3a1>subdomain</span>: <span style=color:#a6e3a1>&#34;bobloblaw&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e3a1>title</span>: <span style=color:#a6e3a1>&#34;Bob Loblaw&#39;s Law Blog&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e3a1>description</span>: <span style=color:#a6e3a1>&#34;Welcome to my new blog.&#34;</span>,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    visit root_path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    expect(page)<span style=color:#89dceb;font-weight:700>.</span>to have_content blog<span style=color:#89dceb;font-weight:700>.</span>title
</span></span><span style=display:flex><span>    expect(page)<span style=color:#89dceb;font-weight:700>.</span>to have_content blog<span style=color:#89dceb;font-weight:700>.</span>description
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p>In our app we render the blog homepage using the following:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#6c7086;font-style:italic># config/routes.rb</span>
</span></span><span style=display:flex><span><span style=color:#f9e2af>Rails</span><span style=color:#89dceb;font-weight:700>.</span>application<span style=color:#89dceb;font-weight:700>.</span>routes<span style=color:#89dceb;font-weight:700>.</span>draw <span style=color:#cba6f7>do</span>
</span></span><span style=display:flex><span>  root <span style=color:#a6e3a1>to</span>: <span style=color:#a6e3a1>&#34;blogs#show&#34;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#6c7086;font-style:italic># app/controllers/blogs_controller.rb</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>class</span> <span style=color:#f9e2af>BlogsController</span> <span style=color:#89dceb;font-weight:700>&lt;</span> <span style=color:#f9e2af>ApplicationController</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>show</span>
</span></span><span style=display:flex><span>    <span style=color:#f5e0dc>@blog</span> <span style=color:#89dceb;font-weight:700>=</span> current_blog
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>private</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>current_blog</span>
</span></span><span style=display:flex><span>    <span style=color:#f5e0dc>@_current_blog</span> <span style=color:#89dceb;font-weight:700>||=</span> <span style=color:#f9e2af>Blog</span><span style=color:#89dceb;font-weight:700>.</span>find_by(<span style=color:#a6e3a1>subdomain</span>: request<span style=color:#89dceb;font-weight:700>.</span>subdomains<span style=color:#89dceb;font-weight:700>.</span>first)
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#6c7086;font-style:italic>&lt;!-- app/views/blogs/show.html.erb --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#cba6f7>h1</span>&gt;<span style=color:#f38ba8>&lt;</span>%= @blog.title %&gt;&lt;/<span style=color:#cba6f7>h1</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#cba6f7>p</span>&gt;<span style=color:#f38ba8>&lt;</span>%= @blog.description %&gt;&lt;/<span style=color:#cba6f7>p</span>&gt;
</span></span></code></pre></div><p>In order to visit the homepage via a subdomain in our test we need to set the <code>app_host</code> property for Capybara. We could try to use <code>myblog.localhost</code> but Rails will think that localhost is the top level domain and therefore won&rsquo;t see myblog as a subdomain. Instead we&rsquo;ll use a fake host name <code>example.com</code>. We can set it by adding the following to our spec before calling <code>visit</code>.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#f9e2af>Capybara</span><span style=color:#89dceb;font-weight:700>.</span>app_host <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#a6e3a1>&#34;http://myblog.example.com&#34;</span>
</span></span></code></pre></div><p>If we run the test with the default Capybara driver, <code>rack-test</code> it should be green. <code>rack-test</code> interacts directly with Rack which means it never uses the external URL. If we need to use a JavaScript driver however we will need to use an actual accessible URL. Add the <code>:js</code> metadata to the scenario and you should see a failure occur.</p><p>In order to accommodate a driver like Selenium or capybara-webkit we&rsquo;ll need to do some more work. To start, we will not be able to use our fake host <code>example.com</code>. Instead we need a host name which will point to <code>127.0.0.1</code>. There is one readily available to us for use through <code>lvh.me</code>. Its DNS records are set up so that <code>lvh.me</code> and all of its subdomains resolve to your local machine at <code>127.0.0.1</code>.</p><p>So update <code>app_host</code> from <code>http://myblog.example.com</code> to <code>http://myblog.lvh.me</code>. We&rsquo;re still not done yet though.</p><p>Next, we need to instruct Capybara to include the port number for the Capybara server in all requests to work correctly. We can do that by adding the following to <code>spec/rails_helper.rb</code>:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#f9e2af>Capybara</span><span style=color:#89dceb;font-weight:700>.</span>configure <span style=color:#cba6f7>do</span> <span style=color:#89dceb;font-weight:700>|</span>config<span style=color:#89dceb;font-weight:700>|</span>
</span></span><span style=display:flex><span>  config<span style=color:#89dceb;font-weight:700>.</span>always_include_port <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#cba6f7>true</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p>If you&rsquo;re using the capybara-webkit driver and configuring it to block all unknown URLs <a href=https://github.com/thoughtbot/suspenders/blob/master/templates/capybara_webkit.rb#L4>as we do in Suspenders</a> then you&rsquo;ll need to do one more thing. In the configuration for capybara-webkit you&rsquo;ll need to add the <code>lvh.me</code> host to the URL whitelist. If you&rsquo;re using a Suspenders based app then open up <code>spec/support/capybara_webkit.rb</code> or whichever file you have configured capybara-webkit in. Update the configuration to look like:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#f9e2af>Capybara</span><span style=color:#89dceb;font-weight:700>::</span><span style=color:#f9e2af>Webkit</span><span style=color:#89dceb;font-weight:700>.</span>configure <span style=color:#cba6f7>do</span> <span style=color:#89dceb;font-weight:700>|</span>config<span style=color:#89dceb;font-weight:700>|</span>
</span></span><span style=display:flex><span>  config<span style=color:#89dceb;font-weight:700>.</span>block_unknown_urls
</span></span><span style=display:flex><span>  config<span style=color:#89dceb;font-weight:700>.</span>allow_url(<span style=color:#a6e3a1>&#34;myblog.lvh.me&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p>This will allow Capybara to access our blog through <code>lvh.me</code> and not block it. With this in place we can run our tests and things should be green again.</p><h2 id=allowing-more-subdomains>Allowing more subdomains</h2><p>Things are working great with the above but we realize that we are coupled to the <code>myblog</code> subdomain within all of our tests. We will finish things off by making this more flexible.</p><p>Let&rsquo;s start by updating our capybara-webkit configuration to allow all subdomains on lvh.me and not just limiting it to <code>myblog</code>. We can do this by changing <code>myblog</code> to <code>*</code>.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#f9e2af>Capybara</span><span style=color:#89dceb;font-weight:700>::</span><span style=color:#f9e2af>Webkit</span><span style=color:#89dceb;font-weight:700>.</span>configure <span style=color:#cba6f7>do</span> <span style=color:#89dceb;font-weight:700>|</span>config<span style=color:#89dceb;font-weight:700>|</span><span style=color:#f38ba8>¬</span>
</span></span><span style=display:flex><span>  config<span style=color:#89dceb;font-weight:700>.</span>block_unknown_urls<span style=color:#f38ba8>¬</span>
</span></span><span style=display:flex><span>  config<span style=color:#89dceb;font-weight:700>.</span>allow_url(<span style=color:#a6e3a1>&#34;*.lvh.me&#34;</span>)<span style=color:#f38ba8>¬</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p>Next, let&rsquo;s extract a helper method to make testing subdomains easier.</p><p>We&rsquo;ll add the following method to our feature spec:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#cba6f7>def</span> <span style=color:#89b4fa>visit_blog</span>(blog, path <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#a6e3a1>&#39;/&#39;</span>)
</span></span><span style=display:flex><span>  app_host <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>URI</span><span style=color:#89dceb;font-weight:700>.</span>join(<span style=color:#a6e3a1>&#34;http://</span><span style=color:#a6e3a1>#{</span>blog<span style=color:#89dceb;font-weight:700>.</span>subdomain<span style=color:#a6e3a1>}</span><span style=color:#a6e3a1>.lvh.me&#34;</span>, path)<span style=color:#89dceb;font-weight:700>.</span>to_s
</span></span><span style=display:flex><span>  using_app_host(app_host) <span style=color:#cba6f7>do</span>
</span></span><span style=display:flex><span>    visit path
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>def</span> <span style=color:#89b4fa>using_app_host</span>(host)
</span></span><span style=display:flex><span>  original_host <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>Capybara</span><span style=color:#89dceb;font-weight:700>.</span>app_host
</span></span><span style=display:flex><span>  <span style=color:#f9e2af>Capybara</span><span style=color:#89dceb;font-weight:700>.</span>app_host <span style=color:#89dceb;font-weight:700>=</span> host
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>yield</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>ensure</span>
</span></span><span style=display:flex><span>  <span style=color:#f9e2af>Capybara</span><span style=color:#89dceb;font-weight:700>.</span>app_host <span style=color:#89dceb;font-weight:700>=</span> original_host
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p><code>using_app_host</code> allows us to pass a host for Capybara to use and temporarily overrides the <code>app_host</code> rather then permanently setting it. Our use of <code>ensure</code> makes sure that the <code>app_host</code> is always set back to its original value regardless of exceptions being raised while <code>yield</code>ing the block. <code>visit_blog</code> allows us to pass an instance of a blog as well as a path to visit. By default, this path is the root of the blog.</p><p>So we can update our spec to look as follows:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#89dceb>require</span> <span style=color:#a6e3a1>&#34;rails_helper&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>feature <span style=color:#a6e3a1>&#34;user views a blog&#34;</span> <span style=color:#cba6f7>do</span>
</span></span><span style=display:flex><span>  scenario <span style=color:#a6e3a1>&#34;homepage&#34;</span>, <span style=color:#a6e3a1>:js</span> <span style=color:#cba6f7>do</span>
</span></span><span style=display:flex><span>     blog <span style=color:#89dceb;font-weight:700>=</span> create(
</span></span><span style=display:flex><span>      <span style=color:#a6e3a1>:blog</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e3a1>subdomain</span>: <span style=color:#a6e3a1>&#34;bobloblaw&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e3a1>title</span>: <span style=color:#a6e3a1>&#34;Bob Loblaw&#39;s Law Blog&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e3a1>description</span>: <span style=color:#a6e3a1>&#34;Welcome to my new blog.&#34;</span>,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    visit_blog blog
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    expect(page)<span style=color:#89dceb;font-weight:700>.</span>to have_content blog<span style=color:#89dceb;font-weight:700>.</span>title
</span></span><span style=display:flex><span>    expect(page)<span style=color:#89dceb;font-weight:700>.</span>to have_content blog<span style=color:#89dceb;font-weight:700>.</span>description
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>visit_blog</span>(blog, path <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#a6e3a1>&#39;/&#39;</span>)
</span></span><span style=display:flex><span>    app_host <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>URI</span><span style=color:#89dceb;font-weight:700>.</span>join(<span style=color:#a6e3a1>&#34;http://</span><span style=color:#a6e3a1>#{</span>blog<span style=color:#89dceb;font-weight:700>.</span>subdomain<span style=color:#a6e3a1>}</span><span style=color:#a6e3a1>.lvh.me&#34;</span>, path)<span style=color:#89dceb;font-weight:700>.</span>to_s
</span></span><span style=display:flex><span>    using_app_host(app_host) <span style=color:#cba6f7>do</span>
</span></span><span style=display:flex><span>      visit path
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>using_app_host</span>(host)
</span></span><span style=display:flex><span>    original_host <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>Capybara</span><span style=color:#89dceb;font-weight:700>.</span>app_host
</span></span><span style=display:flex><span>    <span style=color:#f9e2af>Capybara</span><span style=color:#89dceb;font-weight:700>.</span>app_host <span style=color:#89dceb;font-weight:700>=</span> host
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>yield</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>ensure</span>
</span></span><span style=display:flex><span>    <span style=color:#f9e2af>Capybara</span><span style=color:#89dceb;font-weight:700>.</span>app_host <span style=color:#89dceb;font-weight:700>=</span> original_host
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div></div><footer class="mt-16 pt-8 border-t border-gray-800"><div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"><a href=https://damiangalarza.com/posts/2015-06-12-getting-started-with-ios-development/ class=group><span class="text-sm text-gray-500 group-hover:text-gray-400">← Previous</span><h3 class="font-semibold group-hover:text-[var(--color-accent-teal)] transition-colors">Getting Started with iOS Development</h3></a><a href=https://damiangalarza.com/posts/2024-09-05-react-to-view-components/ class="group text-right"><span class="text-sm text-gray-500 group-hover:text-gray-400">Next →</span><h3 class="font-semibold group-hover:text-[var(--color-accent-teal)] transition-colors">How Buoy Software is Redefining Rails Development with ViewComponents</h3></a></div></footer></div></article></main><footer class="border-t border-gray-800 py-8 px-6 lg:px-8 section-alt flex items-center min-h-[120px]"><div class="max-w-6xl mx-auto w-full"><div class="flex flex-col md:flex-row justify-between items-center gap-4"><div class="text-center md:text-left"><div class="w-16 h-0.5 bg-[var(--color-accent-teal)] mb-3 mx-auto md:mx-0"></div><p class="text-sm text-gray-500">Ready to build something great together?</p><p class="text-xs text-gray-500 mt-2">© 2025 Damian Galarza. All rights reserved.</p></div><div class="flex items-center gap-6"><a href=https://www.linkedin.com/in/dgalarza/ target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="LinkedIn profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 0H5C2.239.0.0 2.239.0 5v14c0 2.761 2.239 5 5 5h14c2.762.0 5-2.239 5-5V5c0-2.761-2.238-5-5-5zM8 19H5V8h3v11zM6.5 6.732c-.966.0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zM20 19h-3v-5.604c0-3.368-4-3.113-4 0V19h-3V8h3v1.765c1.396-2.586 7-2.777 7 2.476V19z"/></svg>
</a><a href=https://github.com/dgalarza target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="GitHub profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
</a><a href=https://twitter.com/dgalarza target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="Twitter profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div></div></div></footer></body></html>