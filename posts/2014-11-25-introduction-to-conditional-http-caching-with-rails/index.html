<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Introduction to Conditional HTTP Caching with Rails - Damian Galarza | Technical Partner for Startups & Fractional CTO</title><meta name=description content="Learn how to implement HTTP conditional caching in Rails using fresh_when."><link rel=stylesheet href=/css/style.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-5Y6WCB7SKQ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5Y6WCB7SKQ")</script><link rel=icon href=/favicon.ico><link rel=canonical href=https://damiangalarza.com/posts/2014-11-25-introduction-to-conditional-http-caching-with-rails/><meta property="og:type" content="article"><meta property="og:title" content="Introduction to Conditional HTTP Caching with Rails"><meta property="og:description" content="Learn how to implement HTTP conditional caching in Rails using fresh_when."><meta property="og:url" content="https://damiangalarza.com/posts/2014-11-25-introduction-to-conditional-http-caching-with-rails/"><meta property="og:site_name" content="Damian Galarza | Technical Partner for Startups & Fractional CTO"><meta property="og:image" content="https://damiangalarza.com/images/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:image:alt" content="Damian Galarza - Technical Partner & Fractional CTO"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@dgalarza"><meta name=twitter:creator content="@dgalarza"><meta name=twitter:image content="https://damiangalarza.com/images/og-image.png"><meta name=twitter:image:alt content="Damian Galarza - Technical Partner & Fractional CTO"><meta property="article:author" content="Damian Galarza"><meta property="article:published_time" content="2014-11-25T00:00:00Z"><meta property="article:modified_time" content="2014-11-25T00:00:00Z"><meta property="article:tag" content="web-development"><meta property="article:tag" content="rails"><meta property="article:tag" content="ruby"><meta property="article:tag" content="performance"><meta property="article:tag" content="caching"><meta property="article:tag" content="tutorial"><meta name=author content="Damian Galarza"><meta name=article:author content="Damian Galarza"><meta name=article:published_time content="2014-11-25T00:00:00Z"><meta name=article:modified_time content="2014-11-25T00:00:00Z"><meta name=article:tag content="web-development"><meta name=article:tag content="rails"><meta name=article:tag content="ruby"><meta name=article:tag content="performance"><meta name=article:tag content="caching"><meta name=article:tag content="tutorial"><meta name=robots content="index, follow"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Introduction to Conditional HTTP Caching with Rails","description":"Learn how to implement HTTP conditional caching in Rails using fresh_when.","author":{"@type":"Person","name":"Damian Galarza","url":"https:\/\/damiangalarza.com\/"},"publisher":{"@type":"Person","name":"Damian Galarza","url":"https:\/\/damiangalarza.com\/"},"datePublished":"2014-11-25T00:00:00Z","dateModified":"2014-11-25T00:00:00Z","url":"https:\/\/damiangalarza.com\/posts\/2014-11-25-introduction-to-conditional-http-caching-with-rails\/","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/damiangalarza.com\/posts\/2014-11-25-introduction-to-conditional-http-caching-with-rails\/"},"keywords":"[\"web-development\",\"rails\",\"ruby\",\"performance\",\"caching\",\"tutorial\"]"}</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel=stylesheet></head><body class="min-h-screen flex flex-col"><header class="fixed top-0 left-0 right-0 z-50 bg-[var(--color-dark-bg)]/95 backdrop-blur-sm"><nav class="max-w-7xl mx-auto px-6 lg:px-12 py-5"><div class="flex items-center justify-between"><a href=https://damiangalarza.com/ class="flex items-center gap-3"><img src=/images/logo-icon.svg alt class="h-6 w-6">
<img src=/images/logo.svg alt="Damian Galarza" class="h-4 w-auto">
</a><button id=menu-toggle class="md:hidden text-gray-400 hover:text-white" aria-label="Toggle mobile menu">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button><div id=menu class="hidden md:flex items-center gap-8"><a href=https://damiangalarza.com/#contact class="btn-primary text-sm">Contact me</a></div></div><div id=mobile-menu class="hidden md:hidden mt-4 pt-4 border-t border-gray-800"><div class="flex flex-col gap-4"><a href=https://damiangalarza.com/ class="text-gray-300 hover:text-white transition-colors">Home</a>
<a href=/posts/ class="text-gray-300 hover:text-white transition-colors">Blog</a>
<a href=https://damiangalarza.com/#contact class="text-gray-300 hover:text-white transition-colors">Contact me</a></div></div></nav></header><script>const menuToggle=document.getElementById("menu-toggle"),mobileMenu=document.getElementById("mobile-menu");menuToggle.addEventListener("click",()=>{mobileMenu.classList.toggle("hidden")})</script><div class=h-20></div><main class=flex-1><article class="py-20 px-6 lg:px-8"><div class="max-w-4xl mx-auto"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/damiangalarza.com\/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https:\/\/damiangalarza.com\/posts/"},{"@type":"ListItem","position":3,"name":"Introduction to Conditional HTTP Caching with Rails","item":"https:\/\/damiangalarza.com\/posts\/2014-11-25-introduction-to-conditional-http-caching-with-rails\/"}]}</script><nav aria-label=Breadcrumb class=mb-12><ol class="flex items-center gap-3 text-sm text-gray-400 min-w-0"><li><a href=https://damiangalarza.com/ class="hover:text-white transition-colors">Home</a></li><li class=text-gray-600><span>/</span></li><li><a href=/posts/ class="hover:text-white transition-colors">Blog</a></li><li class=text-gray-600><span>/</span></li><li class="text-gray-500 truncate" aria-current=page>Introduction to Conditional HTTP Caching with Rails</li></ol></nav><header class=mb-12><h1 class="text-4xl md:text-5xl font-bold mb-4">Introduction to Conditional HTTP Caching with Rails</h1><div class="flex items-center gap-4 text-gray-400"><time datetime=2014-11-25>November 25, 2014</time>
<span>•</span>
<span>7 min read</span></div><div class="flex gap-2 mt-4 flex-wrap"><a href=/tags/web-development class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">web-development
</a><a href=/tags/rails class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">rails
</a><a href=/tags/ruby class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">ruby
</a><a href=/tags/performance class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">performance
</a><a href=/tags/caching class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">caching
</a><a href=/tags/tutorial class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">tutorial</a></div></header><div class="prose prose-invert prose-lg max-w-none"><p>This post was originally published on the <a href=https://thoughtbot.com/blog/introduction-to-conditional-http-caching-with-rails>thoughtbot blog</a>.</p><p>HTTP provides developers with a powerful set of tools to cache responses. Often times we don&rsquo;t want a client to blindly cache content that it has been given. We may not be able to rely on setting specific expiration headers either. Instead we need a way for the client to ask the server whether or not a resource has been updated.</p><p>HTTP provides us with the ability to do this with conditional caching. A client can make a request to the server and find out of the server has a new version of the resource available.</p><p>Rails provides us with tools to take advantage of this. Before we jump into Rails, let&rsquo;s discuss some of the common ways to check if a client&rsquo;s cache is fresh or stale.</p><h2 id=etags>ETags</h2><p>ETags, short for entity tags, are a common way to conditionally verify an HTTP cache. An ETag is a digest which represents the contents of a given resource.</p><p>When a response is returned by the server it will include an ETag to represent the resource&rsquo;s state as part of the HTTP response headers. Subsequent HTTP requests which want to know whether or not the resource has changed since the last request can send along the stored ETag via the <code>If-None-Match</code> header.</p><p>The server will then compare the current ETag for the resource to the one provided by the client. If the two ETags match, the client&rsquo;s cache is considered fresh and the server can respond with a &ldquo;304 Not Modified&rdquo; status.</p><p>If the resource has changed since the last time the client has requested the resource the server will respond with a new ETag and the updated response.</p><h2 id=last-modified-timestamp>Last-Modified Timestamp</h2><p>Another header that a server can supply is the <code>Last-Modified</code> header.</p><p>As the name implies, this will return a timestamp of when the resource was last modified. The client can then include an <code>If-Modified-Since</code> header with the <code>Last-Modified</code> timestamp value to ask the server if the resource has been modified since the previous request.</p><p>Again, if the resource has not been modified since the last request, the server can respond with a &ldquo;304 Not Modified&rdquo; status. Otherwise, it will return an updated representation of the resource and a new <code>Last-Modified</code> timestamp for next time.</p><h2 id=caching-with-fresh_when>Caching with fresh_when</h2><p>Now that we&rsquo;ve discussed the ETags and Last-Modified HTTP headers, let&rsquo;s take a look at how we might use them within our Rails application.</p><p>ActionController provides us with a powerful method called <a href=http://api.rubyonrails.org/classes/ActionController/ConditionalGet.html#method-i-fresh_when><code>fresh_when</code></a>. It will use either an ETag or a Last-Modified timestamp to determine whether or not a resource is fresh or stale.</p><p>Imagine a simple Rails blog application with the following posts route / controller:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#6c7086;font-style:italic># app/controllers/posts_controller.rb</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>class</span> <span style=color:#f9e2af>PostsController</span> <span style=color:#89dceb;font-weight:700>&lt;</span> <span style=color:#f9e2af>ApplicationController</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>show</span>
</span></span><span style=display:flex><span>    <span style=color:#f5e0dc>@post</span> <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>Post</span><span style=color:#89dceb;font-weight:700>.</span>find(params<span style=color:#89dceb;font-weight:700>[</span><span style=color:#a6e3a1>:id</span><span style=color:#89dceb;font-weight:700>]</span>)
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic># config/routes.rb</span>
</span></span><span style=display:flex><span><span style=color:#f9e2af>Rails</span><span style=color:#89dceb;font-weight:700>.</span>application<span style=color:#89dceb;font-weight:700>.</span>routes<span style=color:#89dceb;font-weight:700>.</span>draw <span style=color:#cba6f7>do</span>
</span></span><span style=display:flex><span>  resources <span style=color:#a6e3a1>:posts</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p>If we made a curl request to an individual post we might see something like:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>curl -i http://localhost:3000/posts/1
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#cba6f7>HTTP</span><span style=color:#89dceb;font-weight:700>/</span><span style=color:#fab387>1.1</span> <span style=color:#fab387>200</span> <span style=color:#fab387>OK</span>
</span></span><span style=display:flex><span>Content-Type<span style=color:#89dceb;font-weight:700>:</span> text/html; charset=utf-8
</span></span><span style=display:flex><span>Etag<span style=color:#89dceb;font-weight:700>:</span> &#34;4af7e17fc369c6d1af99f8994d8fd387&#34;
</span></span><span style=display:flex><span>Server<span style=color:#89dceb;font-weight:700>:</span> WEBrick/1.3.1 (Ruby/2.1.2/2014-05-08)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6c7086;font-style:italic>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#cba6f7>html</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#cba6f7>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#cba6f7>h1</span>&gt;Blog post 1&lt;/<span style=color:#cba6f7>h1</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#cba6f7>p</span>&gt;lorem ipsum&lt;/<span style=color:#cba6f7>p</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#cba6f7>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#cba6f7>html</span>&gt;
</span></span></code></pre></div><p>Notice that we have not done anything particularly noteworthy, yet if we take a look at the headers returned as a part of the response we&rsquo;ll see that Rails has sent along an ETag to represent the resource being returned.</p><p>If we keep making the same request via curl we&rsquo;ll see a different ETag value even though the resource has not been modified since our previous request. This goes against the notion of what an ETag would be used for.</p><p>We&rsquo;ll need to modify our controller to instruct it that a request is fresh when a post has not been modified since the last request.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#6c7086;font-style:italic># app/controllers/posts_controller.rb</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>class</span> <span style=color:#f9e2af>PostsController</span> <span style=color:#89dceb;font-weight:700>&lt;</span> <span style=color:#f9e2af>ApplicationController</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>def</span> <span style=color:#89b4fa>show</span>
</span></span><span style=display:flex><span>    <span style=color:#f5e0dc>@post</span> <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>Post</span><span style=color:#89dceb;font-weight:700>.</span>find(params<span style=color:#89dceb;font-weight:700>[</span><span style=color:#a6e3a1>:id</span><span style=color:#89dceb;font-weight:700>]</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    fresh_when <span style=color:#f5e0dc>@post</span>
</span></span><span style=display:flex><span>  <span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><p>Now if we make our previous request over again we&rsquo;ll see that our ETag no longer changes on repeated requests:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>curl -i http://localhost:3000/posts/1
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#f38ba8>Content-Length: 667
</span></span></span><span style=display:flex><span><span style=color:#f38ba8>Content-Type: text/html; charset=utf-8
</span></span></span><span style=display:flex><span><span style=color:#f38ba8>Etag: &#34;534279bfc931d4236713095ffd3efb28&#34;
</span></span></span><span style=display:flex><span><span style=color:#f38ba8>Last-Modified: Wed, 12 Nov 2014 15:44:46 GMT
</span></span></span><span style=display:flex><span><span style=color:#f38ba8>Server: WEBrick/1.3.1 (Ruby/2.1.3/2014-09-19)
</span></span></span></code></pre></div><p>Upon closer inspection of the updated HTTP headers returned in the response, we&rsquo;ll notice that the server has also started returning a <code>Last-Modified</code> timestamp for the post resource.</p><p>Our work is not complete.</p><p>In order to use our cache we need to verify it against the server with the ETag or last modified timestamp with either the <code>If-None-Match</code> or <code>If-Modified-Since</code> headers respectively.</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>curl -i -H <span style=color:#a6e3a1>&#39;If-None-Match: &#34;534279bfc931d4236713095ffd3efb28&#34;&#39;</span> http://localhost:3000/posts/1
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#cba6f7>HTTP</span><span style=color:#89dceb;font-weight:700>/</span><span style=color:#fab387>1.1</span> <span style=color:#fab387>304</span> <span style=color:#fab387>Not Modified</span>
</span></span><span style=display:flex><span>Etag<span style=color:#89dceb;font-weight:700>:</span> &#34;534279bfc931d4236713095ffd3efb28&#34;
</span></span><span style=display:flex><span>Last-Modified<span style=color:#89dceb;font-weight:700>:</span> Wed, 12 Nov 2014 15:44:46 GMT
</span></span><span style=display:flex><span>Server<span style=color:#89dceb;font-weight:700>:</span> WEBrick/1.3.1 (Ruby/2.1.3/2014-09-19)
</span></span></code></pre></div><p>Notice we now receive a 304 Not Modified response, instructing our client that it can use its cached version of the content. Browsers will automatically send a long a stored ETag and Last-Modified timestamp with conditional caching headers for us so we do not actually have to do anything to use this in the browser.</p><p>Let&rsquo;s take a look at the similar request with the <code>If-Modified-Since</code> header:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=display:flex><span>curl -i -H <span style=color:#a6e3a1>&#39;If-Modified-Since: Wed, 12 Nov 2014 15:44:46 GMT&#39;</span> http://localhost:3000/posts/1
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#cba6f7>HTTP</span><span style=color:#89dceb;font-weight:700>/</span><span style=color:#fab387>1.1</span> <span style=color:#fab387>304</span> <span style=color:#fab387>Not Modified</span>
</span></span><span style=display:flex><span>Etag<span style=color:#89dceb;font-weight:700>:</span> &#34;534279bfc931d4236713095ffd3efb28&#34;
</span></span><span style=display:flex><span>Last-Modified<span style=color:#89dceb;font-weight:700>:</span> Wed, 12 Nov 2014 15:44:46 GMT
</span></span><span style=display:flex><span>Server<span style=color:#89dceb;font-weight:700>:</span> WEBrick/1.3.1 (Ruby/2.1.3/2014-09-19)
</span></span></code></pre></div><p>You&rsquo;ll notice that we get the same results, the post has not been modified since the last time and we receive a 304 Not Modified response.</p><h2 id=conclusion>Conclusion</h2><p>What have we gained through all of this? We are still making requests to our server to see if a resource has been modified before rendering.</p><p>To really understand what we&rsquo;ve achieved we can take a look at our Rails log before we had caching:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Started GET &#34;/posts/1&#34; for 127.0.0.1 at 2014-11-12 11:33:57 -0500
</span></span><span style=display:flex><span>Processing by PostsController#show as */*
</span></span><span style=display:flex><span>  Parameters: {&#34;id&#34;=&gt;&#34;1&#34;}
</span></span><span style=display:flex><span>  Post Load (0.3ms)  SELECT  &#34;posts&#34;.* FROM &#34;posts&#34;  WHERE &#34;posts&#34;.&#34;id&#34; = $1
</span></span><span style=display:flex><span>LIMIT 1  [[&#34;id&#34;, 1]]
</span></span><span style=display:flex><span>  Rendered posts/show.html.erb within layouts/application (0.1ms)
</span></span><span style=display:flex><span>  Rendered application/_flashes.html.erb (0.0ms)
</span></span><span style=display:flex><span>  Rendered application/_analytics.html.erb (0.1ms)
</span></span><span style=display:flex><span>  Rendered application/_javascript.html.erb (16.1ms)
</span></span><span style=display:flex><span>Completed 200 OK in 35ms (Views: 33.4ms | ActiveRecord: 0.3ms)
</span></span></code></pre></div><p>We can see that our request takes about 33ms and has to render our posts/show template within the layout along with some other partials. We can also see that most of our time is spent within that rendering process. ActiveRecord took less than a millisecond to run.</p><p>Next, let&rsquo;s take a look at our log with conditional caching in place, and put it to use by sending over a <code>If-None-Match</code> header:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>Started GET &#34;/posts/1&#34; for 127.0.0.1 at 2014-11-12 11:39:52 -0500
</span></span><span style=display:flex><span>Processing by PostsController#show as */*
</span></span><span style=display:flex><span>  Parameters: {&#34;id&#34;=&gt;&#34;1&#34;}
</span></span><span style=display:flex><span>  Post Load (0.3ms)  SELECT  &#34;posts&#34;.* FROM &#34;posts&#34;  WHERE &#34;posts&#34;.&#34;id&#34; = $1
</span></span><span style=display:flex><span>LIMIT 1  [[&#34;id&#34;, 1]]
</span></span><span style=display:flex><span>Completed 304 Not Modified in 2ms (ActiveRecord: 0.3ms)
</span></span></code></pre></div><p>Notice we&rsquo;ve cut off our entire rendering process from the request. Since the client&rsquo;s cached response is fresh there is no reason for Rails to go through the rendering process. It can load in the post via ActiveRecord and verify if it has changed since the previous request.</p><p>Our requests went from taking about 33ms to complete to 2ms. That&rsquo;s about a 94% improvement in performance. Not only is Rails skipping the rendering process, but our responses are now much lighter as they have no body to return.</p><p>This may not be much in our trivial example but for applications which have a lot of complicated logic behind rendering this can save lots of time.</p><p>Furthermore, these requests can be put in front of a public cache such as <code>Rack::Cache</code> to share a common cache for resources as opposed to a private cache which is only utilized by the user&rsquo;s browser.</p><h2 id=getting-more>Getting more</h2><p>Our simple <code>fresh_when</code> solution is not without its limitations.</p><p>It cannot handle user specific content. If we wanted to display anything different on a per-user basis (even if that&rsquo;s the name in the header), we won&rsquo;t be able to cache the content.</p><p>Another issue is that the cache is not being shared among users. Our performance gain is only realized when a single user looks at the same post over and over again.</p><p>Lastly, we&rsquo;re limited to a simple <code>render</code> call in our controller. What if we wanted something more customized like <code>render json:</code> or <code>render xml:</code>? We&rsquo;ll build on top of what we&rsquo;ve learned next time to overcome these limitations and improve our caching even further.</p></div><footer class="mt-16 pt-8 border-t border-gray-800"><div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"><a href=https://damiangalarza.com/posts/scaling-json-apis-in-rails/ class=group><span class="text-sm text-gray-500 group-hover:text-gray-400">← Previous</span><h3 class="font-semibold group-hover:text-[var(--color-accent-teal)] transition-colors">Scaling JSON APIs in Rails using ActiveModel::Serializers, Key-Based Caching, and Rack::Cache</h3></a><a href=https://damiangalarza.com/posts/2015-01-26-take-control-of-your-http-caching-in-rails/ class="group text-right"><span class="text-sm text-gray-500 group-hover:text-gray-400">Next →</span><h3 class="font-semibold group-hover:text-[var(--color-accent-teal)] transition-colors">Take Control of Your HTTP Caching in Rails</h3></a></div></footer></div></article></main><footer class="border-t border-gray-800 py-8 px-6 lg:px-8 section-alt flex items-center min-h-[120px]"><div class="max-w-6xl mx-auto w-full"><div class="flex flex-col md:flex-row justify-between items-center gap-4"><div class="text-center md:text-left"><div class="w-16 h-0.5 bg-[var(--color-accent-teal)] mb-3 mx-auto md:mx-0"></div><p class="text-sm text-gray-500">Ready to build something great together?</p><p class="text-xs text-gray-500 mt-2">© 2025 Damian Galarza. All rights reserved.</p></div><div class="flex items-center gap-6"><a href=https://www.linkedin.com/in/dgalarza/ target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="LinkedIn profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 0H5C2.239.0.0 2.239.0 5v14c0 2.761 2.239 5 5 5h14c2.762.0 5-2.239 5-5V5c0-2.761-2.238-5-5-5zM8 19H5V8h3v11zM6.5 6.732c-.966.0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zM20 19h-3v-5.604c0-3.368-4-3.113-4 0V19h-3V8h3v1.765c1.396-2.586 7-2.777 7 2.476V19z"/></svg>
</a><a href=https://github.com/dgalarza target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="GitHub profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
</a><a href=https://twitter.com/dgalarza target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="Twitter profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div></div></div></footer></body></html>