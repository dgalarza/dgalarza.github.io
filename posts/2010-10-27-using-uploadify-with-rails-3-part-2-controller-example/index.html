<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Using Uploadify with Rails 3 - Part 2 - Controller Example - Damian Galarza | Technical Partner for Startups & Fractional CTO</title><meta name=description content="A follow-up post on using Uploadify with Rails 3, focusing on setting up the controller to work with file uploads. This part covers handling content types …"><link rel=stylesheet href=/css/style.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-5Y6WCB7SKQ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5Y6WCB7SKQ")</script><link rel=icon href=/favicon.ico><link rel=canonical href=https://damiangalarza.com/posts/2010-10-27-using-uploadify-with-rails-3-part-2-controller-example/><meta property="og:type" content="article"><meta property="og:title" content="Using Uploadify with Rails 3 - Part 2 - Controller Example"><meta property="og:description" content><meta property="og:url" content="https://damiangalarza.com/posts/2010-10-27-using-uploadify-with-rails-3-part-2-controller-example/"><meta property="og:site_name" content="Damian Galarza | Technical Partner for Startups & Fractional CTO"><meta property="og:image" content="https://damiangalarza.com/images/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="og:image:alt" content="Damian Galarza - Technical Partner & Fractional CTO"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@dgalarza"><meta name=twitter:creator content="@dgalarza"><meta name=twitter:image content="https://damiangalarza.com/images/og-image.png"><meta name=twitter:image:alt content="Damian Galarza - Technical Partner & Fractional CTO"><meta property="article:author" content="Damian Galarza"><meta property="article:published_time" content="2010-10-27T02:08:08Z"><meta property="article:modified_time" content="2010-10-27T02:08:08Z"><meta property="article:tag" content="web-development"><meta property="article:tag" content="rails"><meta property="article:tag" content="ruby"><meta property="article:tag" content="tutorial"><meta name=author content="Damian Galarza"><meta name=article:author content="Damian Galarza"><meta name=article:published_time content="2010-10-27T02:08:08Z"><meta name=article:modified_time content="2010-10-27T02:08:08Z"><meta name=article:tag content="web-development"><meta name=article:tag content="rails"><meta name=article:tag content="ruby"><meta name=article:tag content="tutorial"><meta name=robots content="index, follow"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using Uploadify with Rails 3 - Part 2 - Controller Example","description":"A follow-up post on using Uploadify with Rails 3, focusing on setting up the controller to work with file uploads. This part covers handling content types and provides a full code sample for a Paperclip-based model and controller method.","author":{"@type":"Person","name":"Damian Galarza","url":"https:\/\/damiangalarza.com\/"},"publisher":{"@type":"Person","name":"Damian Galarza","url":"https:\/\/damiangalarza.com\/"},"datePublished":"2010-10-27T02:08:08Z","dateModified":"2010-10-27T02:08:08Z","url":"https:\/\/damiangalarza.com\/posts\/2010-10-27-using-uploadify-with-rails-3-part-2-controller-example\/","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/damiangalarza.com\/posts\/2010-10-27-using-uploadify-with-rails-3-part-2-controller-example\/"},"keywords":"[\"web-development\",\"rails\",\"ruby\",\"tutorial\"]"}</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel=stylesheet></head><body class="min-h-screen flex flex-col"><header class="fixed top-0 left-0 right-0 z-50 bg-[var(--color-dark-bg)]/95 backdrop-blur-sm"><nav class="max-w-7xl mx-auto px-6 lg:px-12 py-5"><div class="flex items-center justify-between"><a href=https://damiangalarza.com/ class="flex items-center gap-3"><img src=/images/logo-icon.svg alt class="h-6 w-6">
<img src=/images/logo.svg alt="Damian Galarza" class="h-4 w-auto">
</a><button id=menu-toggle class="md:hidden text-gray-400 hover:text-white" aria-label="Toggle mobile menu">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg></button><div id=menu class="hidden md:flex items-center gap-8"><a href=https://damiangalarza.com/#contact class="btn-primary text-sm">Contact me</a></div></div><div id=mobile-menu class="hidden md:hidden mt-4 pt-4 border-t border-gray-800"><div class="flex flex-col gap-4"><a href=https://damiangalarza.com/ class="text-gray-300 hover:text-white transition-colors">Home</a>
<a href=/posts/ class="text-gray-300 hover:text-white transition-colors">Blog</a>
<a href=https://damiangalarza.com/#contact class="text-gray-300 hover:text-white transition-colors">Contact me</a></div></div></nav></header><script>const menuToggle=document.getElementById("menu-toggle"),mobileMenu=document.getElementById("mobile-menu");menuToggle.addEventListener("click",()=>{mobileMenu.classList.toggle("hidden")})</script><div class=h-20></div><main class=flex-1><article class="py-20 px-6 lg:px-8"><div class="max-w-4xl mx-auto"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/damiangalarza.com\/"},{"@type":"ListItem","position":2,"name":"Blog","item":"https:\/\/damiangalarza.com\/posts/"},{"@type":"ListItem","position":3,"name":"Using Uploadify with Rails 3 - Part 2 - Controller Example","item":"https:\/\/damiangalarza.com\/posts\/2010-10-27-using-uploadify-with-rails-3-part-2-controller-example\/"}]}</script><nav aria-label=Breadcrumb class=mb-12><ol class="flex items-center gap-3 text-sm text-gray-400 min-w-0"><li><a href=https://damiangalarza.com/ class="hover:text-white transition-colors">Home</a></li><li class=text-gray-600><span>/</span></li><li><a href=/posts/ class="hover:text-white transition-colors">Blog</a></li><li class=text-gray-600><span>/</span></li><li class="text-gray-500 truncate" aria-current=page>Using Uploadify with Rails 3 - Part 2 - Controller Example</li></ol></nav><header class=mb-12><h1 class="text-4xl md:text-5xl font-bold mb-4">Using Uploadify with Rails 3 - Part 2 - Controller Example</h1><div class="flex items-center gap-4 text-gray-400"><time datetime=2010-10-27>October 27, 2010</time>
<span>•</span>
<span>2 min read</span></div><div class="flex gap-2 mt-4 flex-wrap"><a href=/tags/web-development class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">web-development
</a><a href=/tags/rails class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">rails
</a><a href=/tags/ruby class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">ruby
</a><a href=/tags/tutorial class="text-sm px-3 py-1 bg-gray-800 hover:bg-gray-700 rounded-full text-gray-300 transition-colors">tutorial</a></div></header><div class="prose prose-invert prose-lg max-w-none"><p>Back in August <a href=http://www.glrzad.com/ruby-on-rails/using-uploadify-with-rails-3/ title="Using Uploadify with Rails 3">I posted a walkthrough</a> on working with a Flash based file uploader with Rails 3. After reading some comments I realized that a part was left out. Setting up the controller to work with our upload. So this post is here as part 2 of &lsquo;Using Uploadify with Rails 3&rsquo;.</p><p>This sample is going to be using the <a href=http://github.com/thoughtbot/paperclip title="paperclip by thoughtbot">paperclip gem by thoughtbot</a> to handle our upload.</p><h3 id=the-controller>The Controller</h3><p>So we&rsquo;ve gotten our file uploaded successfully, authentication is passing thanks to our previous work but what now? One of the first issues that you might run into is the content type for the file you uploaded. Our uploadify upload will actually have the content_type set to &lsquo;application/octet-stream&rsquo; which is not totally accurate representation of what we&rsquo;re uploading.</p><p>As stated earlier, this example is using paperclip, which will need the true content_type to be set to accurately continue uploading the file. To resolve the &lsquo;application/octet-stream&rsquo; issue we can use the mime-type gem and set the content_type of the file afterwards in the controller before trying to save the upload. Add the following to your gem file and run a bundle install:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span>gem <span style=color:#a6e3a1>&#39;mime-types&#39;</span>, <span style=color:#a6e3a1>:require</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>&#39;mime/types&#39;</span>
</span></span></code></pre></div><p>With this in place we can force our controller to set the content type of the upload to the proper value.</p><p>We can do this with the following code:</p><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span>params<span style=color:#89dceb;font-weight:700>[</span><span style=color:#a6e3a1>:Filedata</span><span style=color:#89dceb;font-weight:700>].</span>content_type <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>MIME</span><span style=color:#89dceb;font-weight:700>::</span><span style=color:#f9e2af>Types</span><span style=color:#89dceb;font-weight:700>.</span>type_for(params<span style=color:#89dceb;font-weight:700>[</span><span style=color:#a6e3a1>:Filedata</span><span style=color:#89dceb;font-weight:700>].</span>original_filename)<span style=color:#89dceb;font-weight:700>.</span>to_s
</span></span></code></pre></div><p>Below is a full code sample of our Paperclip based model, and the full create controller method for handling our upload. I hope you&rsquo;ve found this post useful and please feel free to comment below with any questions, as I&rsquo;ll try to get to them as soon as possible.</p><h4 id=galleryimage-model>GalleryImage Model</h4><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#cba6f7>class</span> <span style=color:#f9e2af>GalleryImage</span> <span style=color:#89dceb;font-weight:700>&lt;</span> <span style=color:#f9e2af>ActiveRecord</span><span style=color:#89dceb;font-weight:700>::</span><span style=color:#f9e2af>Base</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	belongs_to <span style=color:#a6e3a1>:gallery</span>
</span></span><span style=display:flex><span>	delegate <span style=color:#a6e3a1>:venue</span>, <span style=color:#a6e3a1>:to</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>:gallery</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6c7086;font-style:italic># Storing photos in /galleries/:venue_name/:gallery_id/...</span>
</span></span><span style=display:flex><span>	has_attached_file <span style=color:#a6e3a1>:photo</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e3a1>:styles</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> { <span style=color:#a6e3a1>:thumb</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>&#34;70x70&#34;</span>, <span style=color:#a6e3a1>:iphone_thumb</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>&#34;30x30#&#34;</span>, <span style=color:#a6e3a1>:iphone_full</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>&#34;320x480&#34;</span> },
</span></span><span style=display:flex><span>		<span style=color:#a6e3a1>:url</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>&#39;/galleries/:venue/:gallery/:id/:attachment/:style/:basename.:extension&#39;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e3a1>:path</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>&#39;:rails_root/public/galleries/:venue/:gallery/:id/:attachment/:style/:basename.:extension&#39;</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div><h4 id=galleryimagescontroller>GalleryImagesController</h4><div class=highlight><pre tabindex=0 style=color:#cdd6f4;background-color:#1e1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#cba6f7>def</span> <span style=color:#89b4fa>create</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f5e0dc>@gallery</span> <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>Gallery</span><span style=color:#89dceb;font-weight:700>.</span>find(params<span style=color:#89dceb;font-weight:700>[</span><span style=color:#a6e3a1>:gallery_id</span><span style=color:#89dceb;font-weight:700>]</span>)
</span></span><span style=display:flex><span>	<span style=color:#f5e0dc>@gallery_image</span> <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>GalleryImage</span><span style=color:#89dceb;font-weight:700>.</span>new
</span></span><span style=display:flex><span>	<span style=color:#f5e0dc>@gallery_image</span><span style=color:#89dceb;font-weight:700>.</span>gallery <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f5e0dc>@gallery</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#6c7086;font-style:italic># Associate the correct MIME type for the file since Flash will change it</span>
</span></span><span style=display:flex><span>	params<span style=color:#89dceb;font-weight:700>[</span><span style=color:#a6e3a1>:Filedata</span><span style=color:#89dceb;font-weight:700>].</span>content_type <span style=color:#89dceb;font-weight:700>=</span> <span style=color:#f9e2af>MIME</span><span style=color:#89dceb;font-weight:700>::</span><span style=color:#f9e2af>Types</span><span style=color:#89dceb;font-weight:700>.</span>type_for(params<span style=color:#89dceb;font-weight:700>[</span><span style=color:#a6e3a1>:Filedata</span><span style=color:#89dceb;font-weight:700>].</span>original_filename)<span style=color:#89dceb;font-weight:700>.</span>to_s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f5e0dc>@gallery_image</span><span style=color:#89dceb;font-weight:700>.</span>photo <span style=color:#89dceb;font-weight:700>=</span> params<span style=color:#89dceb;font-weight:700>[</span><span style=color:#a6e3a1>:Filedata</span><span style=color:#89dceb;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#cba6f7>if</span> <span style=color:#f5e0dc>@gallery_image</span><span style=color:#89dceb;font-weight:700>.</span>save
</span></span><span style=display:flex><span>		render <span style=color:#a6e3a1>:json</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> { <span style=color:#a6e3a1>&#39;status&#39;</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>&#39;success&#39;</span>  }
</span></span><span style=display:flex><span>	<span style=color:#cba6f7>else</span>
</span></span><span style=display:flex><span>		render <span style=color:#a6e3a1>:json</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> { <span style=color:#a6e3a1>&#39;status&#39;</span> <span style=color:#89dceb;font-weight:700>=&gt;</span> <span style=color:#a6e3a1>&#39;error&#39;</span> }
</span></span><span style=display:flex><span>	<span style=color:#cba6f7>end</span>
</span></span><span style=display:flex><span><span style=color:#cba6f7>end</span>
</span></span></code></pre></div></div><footer class="mt-16 pt-8 border-t border-gray-800"><div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"><a href=https://damiangalarza.com/posts/2010-08-25-using-uploadify-with-rails-3/ class=group><span class="text-sm text-gray-500 group-hover:text-gray-400">← Previous</span><h3 class="font-semibold group-hover:text-[var(--color-accent-teal)] transition-colors">Using Uploadify with Rails 3</h3></a><a href=https://damiangalarza.com/posts/2010-12-04-gradient-generator-updated/ class="group text-right"><span class="text-sm text-gray-500 group-hover:text-gray-400">Next →</span><h3 class="font-semibold group-hover:text-[var(--color-accent-teal)] transition-colors">Gradient Generator Updated</h3></a></div></footer></div></article></main><footer class="border-t border-gray-800 py-8 px-6 lg:px-8 section-alt flex items-center min-h-[120px]"><div class="max-w-6xl mx-auto w-full"><div class="flex flex-col md:flex-row justify-between items-center gap-4"><div class="text-center md:text-left"><div class="w-16 h-0.5 bg-[var(--color-accent-teal)] mb-3 mx-auto md:mx-0"></div><p class="text-sm text-gray-500">Ready to build something great together?</p><p class="text-xs text-gray-500 mt-2">© 2025 Damian Galarza. All rights reserved.</p></div><div class="flex items-center gap-6"><a href=https://www.linkedin.com/in/dgalarza/ target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="LinkedIn profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 0H5C2.239.0.0 2.239.0 5v14c0 2.761 2.239 5 5 5h14c2.762.0 5-2.239 5-5V5c0-2.761-2.238-5-5-5zM8 19H5V8h3v11zM6.5 6.732c-.966.0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zM20 19h-3v-5.604c0-3.368-4-3.113-4 0V19h-3V8h3v1.765c1.396-2.586 7-2.777 7 2.476V19z"/></svg>
</a><a href=https://github.com/dgalarza target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="GitHub profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
</a><a href=https://twitter.com/dgalarza target=_blank rel=noopener class="text-gray-400 hover:text-accent-teal transition-colors" aria-label="Twitter profile"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></div></div></div></footer></body></html>